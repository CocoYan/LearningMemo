# ElasticSearch 基础概念

## Doc 文档
* 文档是所有可搜索数据的最小单位。如一篇文章、一个视频。
* 文档会被序列化成JSON格式存储
* 每个文档都有一个Unique ID。可在创建时指定，也可自动生成。

## Index 索引
* 索引是一类文档的集合。
* 每个索引都有自己的mapping定义，用于定义所包含文档的字段名和字段类型。
* 索引的setting定义了其数据的物理分布。

## Shard 分片
* Shard是物理空间的概念，索引中的数据分散在Shard上。
* Shard分为主分片(Primary Shard)和副本(Replica Shard)
  * 主分片，用于解决数据水平扩展的问题。通过主分片，可以将数据分布到集群内的所有节点上。
    * 主分片在索引创建时指定，数量和分布都确定下来，后续不允许修改。因此若此时扩展集群，主分片也无法得到扩展。
  * 副本，是主分片的拷贝，用于解决数据高可用的问题。‘
    * 副本数量可以动态调整。
    * 增加副本数量，可以在一定程度上提高服务的可用性（读取的吞吐）
* 分片的设定
  * 分片数量过少：1. 导致后续无法水平扩展；2. 单个分片的数据量太大，导致数据重新分配耗时。
  * 分片数量过多：1. 影响搜索结果的相关性打分，影响统计结果的准确性；2. 单个节点上过多的分片，会导致资源浪费，同时也会影响性能。
  
```json
PUT /blogs
{
  "settings": {
    "number_of_shards": 3,
    "number_of_replicas": 1
  }
}
```

## Node 节点
* 节点是一个ElasticSearch实例，本质上是一个Java进程。
* 一台机器上可以运行多个ElasticSearch进程，也就是多个节点。（生产环境建议一台机器上只运行一个节点）
* 集群中只有一个主节点。只有主节点能修改集群状态。默认每个节点都是master eligible的。
* 每个节点都有名字。启动后，系统会分配一个UID，保存在data目录下。
* 节点分类：
  * Data Node：可以保存数据的节点。负责保存分片数据。在数据扩展上起到了至关重要的作用。
  * Coordicate Node：负责接收Client的请求，将请求分发到合适的节点，最终把结果汇集到一起。每个节点默认都起到了Coordinating Node的职责。
* 配置节点类型：
  * 开发环境中一个节点可以承担多重角色；
  * 生产环境中应该设置单一角色的节点（dedicated node）。
  
## 集群健康状态
```json
GET _cluster/health
```
* Green：主分片与副本都正常分配；
* Yellow：主分片全部正常分配，部分副本未能正常分配；
* Red：有主分片未能正常分配。
